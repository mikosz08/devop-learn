import threading
from time import sleep
import PySimpleGUI as sg
from translate_from_binary import translate
from Utils.cls import clear_console


class BinGUI:
    def main(self):
        window = self.init_window()

        while True:
            event, values = window.read()
            if event == sg.WIN_CLOSED or event == '-EXIT-':
                break
            elif event == "-BtT-":
                binary = values["-BINARY-"]
                window["-TEXT-"].update(translate(binary))
                #This creates the 'animation' of pulling the binary string, it's cool, but slow with larger strings.
                # pull_thread = threading.Thread(
                #     self.pull_binary(binary, window))
                # push_thread = threading.Thread(
                #     self.push_text(binary, window))

                # pull_thread.start()
                # push_thread.start()

                # pull_thread.join()
                # push_thread.join()

            elif event == "-TtB-":
                pass

            if event == "update_binary":
                window["-BINARY-"].update(values[event])
                window.refresh()

            if event == "update_text":
                window["-TEXT-"].update(
                    f'{window["-TEXT-"].get()} {values[event]}')
                sleep(0.1)
                window.refresh()

        window.close()
        clear_console()

    def init_window(self):
        sg.theme('Reds')
        window_layout = self.init_layout()
        return sg.Window(title="Binary Converter", layout=window_layout)

    def init_layout(self):

        layout_binary = [
            [sg.Frame('Enter Binary Code', [
                [sg.Multiline(
"""01010111 01100001 01110010 01100011 01110010 01100001 01100110
01110100 00100000 01101001 01110011 00100000 01100001 00100000
01100110 01110010 01100001 01101110 01100011 01101000 01101001
01110011 01100101 00100000 01101111 01100110 00100000 01110110
01101001 01100100 01100101 01101111 00100000 01100111 01100001
01101101 01100101 01110011 00101100 00100000 01101110 01101111
01110110 01100101 01101100 01110011 00101100 00100000 01100001
01101110 01100100 00100000 01101111 01110100 01101000 01100101
01110010 00100000 01101101 01100101 01100100 01101001 01100001
00100000 01100011 01110010 01100101 01100001 01110100 01100101
01100100 00100000 01100010 01111001 00100000 01000010 01101100
01101001 01111010 01111010 01100001 01110010 01100100 00100000
01000101 01101110 01110100 01100101 01110010 01110100 01100001
01101001 01101110 01101101 01100101 01101110 01110100 00101110
00100000 01010100 01101000 01100101 00100000 01110011 01100101
01110010 01101001 01100101 01110011 00100000 01101001 01110011
00100000 01101101 01100001 01100100 01100101 00100000 01110101
01110000 00100000 01101111 01100110 00100000 01100110 01101001
01110110 01100101 00100000 01100011 01101111 01110010 01100101
00100000 01100111 01100001 01101101 01100101 01110011 00111010
00100000 01010111 01100001 01110010 01100011 01110010 01100001
01100110 01110100 00111010 00100000 01001111 01110010 01100011
01110011 00100000 00100110 00100000 01001000 01110101 01101101
01100001 01101110 01110011 00101100 00100000 01010111 01100001
01110010 01100011 01110010 01100001 01100110 01110100 00100000
01001001 01001001 00111010 00100000 01010100 01101001 01100100
01100101 01110011 00100000 01101111 01100110 00100000 01000100
01100001 01110010 01101011 01101110 01100101 01110011 01110011
00101100 00100000 01010111 01100001 01110010 01100011 01110010
01100001 01100110 01110100 00100000 01001001 01001001 01001001
00111010 00100000 01010010 01100101 01101001 01100111 01101110
00100000 01101111 01100110 00100000 01000011 01101000 01100001
01101111 01110011 00101100 00100000 01010111 01101111 01110010
01101100 01100100 00100000 01101111 01100110 00100000 01010111
01100001 01110010 01100011 01110010 01100001 01100110 01110100
00101100 00100000 01100001 01101110 01100100 00100000 01001000
01100101 01100001 01110010 01110100 01101000 01110011 01110100
01101111 01101110 01100101 00101110 00100000 01010100 01101000
01100101 00100000 01100110 01101001 01110010 01110011 01110100
00100000 01110100 01101000 01110010 01100101 01100101 00100000
01101111 01100110 00100000 01110100 01101000 01100101 01110011
01100101 00100000 01100011 01101111 01110010 01100101 00100000
01100111 01100001 01101101 01100101 01110011 00100000 01100001
01110010 01100101 00100000 01101001 01101110 00100000 01110100
01101000 01100101 00100000 01110010 01100101 01100001 01101100
00101101 01110100 01101001 01101101 01100101 00100000 01110011
01110100 01110010 01100001 01110100 01100101 01100111 01111001
00100000 01100111 01100101 01101110 01110010 01100101 00101100
00100000 01110111 01101000 01100101 01110010 01100101 00100000
01101111 01110000 01110000 01101111 01110011 01101001 01101110
01100111 00100000 01110000 01101100 01100001 01111001 01100101
01110010 01110011 00100000 01100011 01101111 01101101 01101101
01100001 01101110 01100100 00100000 01110110 01101001 01110010
01110100 01110101 01100001 01101100 00100000 01100001 01110010
01101101 01101001 01100101 01110011 00100000 01101001 01101110
00100000 01100010 01100001 01110100 01110100 01101100 01100101
00100000 01100001 01100111 01100001 01101001 01101110 01110011
01110100 00100000 01100101 01100001 01100011 01101000 00100000
01101111 01110100 01101000 01100101 01110010 00100000 01101111
01110010 00100000 01100001 00100000 01100011 01101111 01101101
01110000 01110101 01110100 01100101 01110010 00101101 01100011
01101111 01101110 01110100 01110010 01101111 01101100 01101100
01100101 01100100 00100000 01100101 01101110 01100101 01101101
01111001 00101110 00100000 01010100 01101000 01100101 00100000
01100110 01101111 01110101 01110010 01110100 01101000 00100000
01100001 01101110 01100100 00100000 01100010 01100101 01110011
01110100 00101101 01110011 01100101 01101100 01101100 01101001
01101110 01100111 00100000 01110100 01101001 01110100 01101100
01100101 00100000 01101111 01100110 00100000 01110100 01101000
01100101 00100000 01100110 01110010 01100001 01101110 01100011
01101000 01101001 01110011 01100101 00100000 01101001 01110011
00100000 01100001 00100000 01101101 01100001 01110011 01110011
01101001 01110110 01100101 01101100 01111001 00100000 01101101
01110101 01101100 01110100 01101001 01110000 01101100 01100001
01111001 01100101 01110010 00100000 01101111 01101110 01101100
01101001 01101110 01100101 00100000 01110010 01101111 01101100
01100101 00101101 01110000 01101100 01100001 01111001 01101001
01101110 01100111 00100000 01100111 01100001 01101101 01100101
00100000 00101000 01001101 01001101 01001111 01010010 01010000
01000111 00101001 00101100 00100000 01110111 01101000 01100101
01110010 01100101 00100000 01110000 01101100 01100001 01111001
01100101 01110010 01110011 00100000 01100011 01101111 01101110
01110100 01110010 01101111 01101100 00100000 01110100 01101000
01100101 01101001 01110010 00100000 01100011 01101000 01100001
01110010 01100001 01100011 01110100 01100101 01110010 00100000
01100001 01101110 01100100 00100000 01101001 01101110 01110100
01100101 01110010 01100001 01100011 01110100 00100000 01110111
01101001 01110100 01101000 00100000 01100101 01100001 01100011
01101000 00100000 01101111 01110100 01101000 01100101 01110010
00100000 01101001 01101110 00100000 01100001 00100000 01110110
01101001 01110010 01110100 01110101 01100001 01101100 00100000
01110111 01101111 01110010 01101100 01100100 00101110 00100000
01010111 01100001 01110010 01100011 01110010 01100001 01100110
01110100 00100000 01101001 01110011 00100000 01101111 01101110
01100101 00100000 01101111 01100110 00100000 01110100 01101000
01100101 00100000 01101000 01101001 01100111 01101000 01100101
01110011 01110100 00101101 01100111 01110010 01101111 01110011
01110011 01101001 01101110 01100111 00100000 01110110 01101001
01100100 01100101 01101111 00100000 01100111 01100001 01101101
01100101 00100000 01100110 01110010 01100001 01101110 01100011
01101000 01101001 01110011 01100101 01110011 00100000 01101111
01100110 00100000 01100001 01101100 01101100 00100000 01110100
01101001 01101101 01100101 00101100 00100000 01101000 01100001
01110110 01101001 01101110 01100111 00100000 01100111 01110010
01101111 01110011 01110011 01100101 01100100 00100000 00100100
00110001 00110001 00101110 00110010 00100000 01100010 01101001
01101100 01101100 01101001 01101111 01101110 00100000 01101001
01101110 00100000 01101100 01101001 01100110 01100101 01110100
01101001 01101101 01100101 00100000 01110010 01100101 01110110
01100101 01101110 01110101 01100101 00101100 00100000 01100001
01110011 00100000 01101111 01100110 00100000 00110010 00110000
00110001 00111000 00101110
""", key="-BINARY-", size=(None, 10))]
            ])]
        ]

        layout_text = [
            [sg.Frame('Text', [
                [sg.Multiline("", key="-TEXT-", size=(None, 10))]
            ])]]

        buttons_size = 10
        centered = [
            [sg.Frame('Options', [
                [
                    sg.Button("To_Text", size=(
                        buttons_size, None), key='-BtT-'),
                    sg.Exit('Exit', size=(buttons_size, None), key='-EXIT-'),
                    sg.Button("To_Binary", size=(buttons_size, None),
                              key='-TtB-', disabled=True)
                ]
            ])]

        ]

        layout = [
            [layout_binary],
            # [sg.VPush()],
            [sg.Push(),
             sg.Column(centered, element_justification='c'),
             sg.Push()],
            # [sg.VPush()],
            [layout_text]
        ]

        return layout

    def pull_binary(self, binary: str, window):
        while binary:
            binary = binary[1:]
            window.write_event_value("update_binary", binary)

    def push_text(self, binary: str, window):
        text = translate(binary).split()
        for word in text:
            window.write_event_value("update_text", word)


if __name__ == "__main__":
    program = BinGUI()
    program.main()
